<%
def to_config(list)
  return '' unless list

  list.inject([]) do |out, obj|
    out + obj.map do |(name, config)|
      chunk = []
      chunk << "  #{name} {"
      config.sort.each do |key, value|
        if value.kind_of?(Hash)
          value.each_pair do |k, v|
            chunk << "    #{key} => #{[k,v].inspect}"
          end
        else
          chunk << "    #{key} => #{value.inspect}"
        end
      end
      chunk << '  }'
      chunk.join("\n")
    end
  end.join("\n\n")
end
-%>
input {
<%= to_config(@config['inputs']) %>
}

filter {
<%= to_config(@config['filters']) %>
}

output {
<%= to_config(@config['outputs']) %>
  elasticsearch {
    embedded => false
    cluster => "<%= node['logstash']['elasticsearch']['cluster']['name'] %>"
  }
}
